*** Settings ***
Resource   lib/vomsadminlib.txt


*** Test Cases ***

Check that adding a non existing user in non existing group fails
  ${output}  Add user to group and check failure  ${non_existent_user}  ${non_existent_group} 
  ${subject}  Get named certificate subject  ${non_existent_user}
  ${issuer}   Get named certificate issuer  ${non_existent_user}  
  Should contain  ${output}  User '${subject},${issuer}' not found in this vo

Check that adding a non existing user in an existing group fails
  ${output}  Add user to group and check failure  ${non_existent_user}  ${non_registered_group}
  ${subject}  Get named certificate subject  ${non_existent_user}
  ${issuer}   Get named certificate issuer  ${non_existent_user}
  Should contain  ${output}  User '${subject},${issuer}' not found in this vo

Check that adding a user to a group who is already a member of fails
  ${output}  Add user to group and check failure  ${existent_user}  ${registered_group}
  Should contain  ${output}  is already a member of group

Check that adding an existing user to a group who is not yet a member of works
  Add user to group  ${existent_user}  ${non_registered_group}
  [Teardown]  Remove user from group  ${existent_user}  ${non_registered_group}

Check that assigning a non existing role of non existing user in non existing group fails
  ${output}  Assign role and check failure   ${non_existent_user}  ${non_existent_group}  ${non_existent_role}
  ${subject}  Get named certificate subject  ${non_existent_user}
  ${issuer}   Get named certificate issuer  ${non_existent_user}
  Should contain  ${output}  User '${subject},${issuer}' not found in database

Check that assigning an existent role in a non existent group for an existent user fails
  ${output}  Assign role and check failure   ${existent_user}  ${non_existent_group}  ${non_assigned_role}
  Should Match Regexp  ${output}  .+ Group '.*${non_existent_group}' not found in database

Check that assigning role in a group for a non existent user fails
  ${output}  Assign role and check failure   ${non_existent_user}    ${non_registered_group}  ${non_assigned_role}
  Should Match Regexp  ${output}  .+ User '.+${non_existent_user}.+' not found in database

Check that assigning a role in a group for a user who doesn't have that role works
  Assign role   ${existent_user}  ${registered_group}  ${non_assigned_role}
  [Teardown]  Dismiss role  ${existent_user}  ${registered_group}  ${non_assigned_role}
 
Check that setting ACL on non-existing group fails
  ${output}  Set ACL for group and check failure   ${existent_user}  ${non_existent_group}  ALL  FALSE
  Should Match Regexp  ${output}  .+ Group '.*${non_existent_group}' is not defined for this vo

Check that trying to set each permission for an existing group/user context works
  :FOR    ${perm}   IN   @{ACL_perms}
  \    Set ACL permission for a user in a group  ${existent_user}  ${registered_group}  ${perm}  FALSE
  \    ${output}  Get ACL permission for a group   ${registered_group} 
  \    Log  ${output} 
  \    Should Match Regexp  ${output}  .+${existent_user}.+${perm}
  [Teardown]  Set ACL permission for a user in a group  ${existent_user}  ${registered_group}  ALL  FALSE
